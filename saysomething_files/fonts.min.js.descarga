"use strict";define("fonts/utils/fontUtils",["lodash","utils","coreUtilsLib"],function(t,e,n){function r(t,e){k[t]=e}function o(t,e){_[t]=e}function a(t){return e.cssUtils.parseFontStr(t)}function s(e){return t.compact(t.map(e,function(t){return P.getFontsMetaData()[t]}))}function i(e){return t(e).split(",").invokeMap("replace",/.*[^\w\d\-].*/,'"$&"').join(",")}function l(t){var e,n=P.getFontsMetaData()[t.toLowerCase()],r=n.fontFamily;return n?(e=r,""!==n.fallbacks&&(e+=","+n.fallbacks),e+=","+n.genericFamily):e=t,i(e)}function u(e,n){if(0!==e.length){var r=t.map(e,function(t){return t.cdnName+":n,b,i,bi|"});return n&&(r.push("&subset="),r.push(n.join(","))),W+r.join("")}}function f(e,n){return s(t.filter(c(e,n),function(e){return t.has(P.getFontsMetaData(),e)}))}function c(t,e){return g(t,e)}function F(e){return d(e,t.times(11,function(t){return"font_"+t}))}function g(n,r){var o=n.getPageDataMap(r,n.dataTypes.DATA),a=t(o).filter(function(e){return t.has(k,e.type)}).map(function(r){var o=k[r.type](n,r);return t.union(e.fonts.fontsParser.collectFontsFromTextDataArray(o))}).flattenDeep().value(),s=t(o).filter(function(e){return t.has(_,e.type)}).map(function(t){return _[t.type](n,t)||[]}).flattenDeep().value(),i=t.get(o,"masterPage.usedFonts",[]);return t.union(a,s,F(n),i)}function d(e,n){var r=e.getGeneralTheme();return t.map(n,function(t){return m(r,t)})}function m(t,e){var n=t.font[parseInt(e.substring(e.indexOf("_")+1),10)],r="";return n&&(r=a(n).family.toLowerCase()),r}function p(e,n){var r=T(e,n);return t.values(r)}function v(e,n){var r=y(e);return t(D).intersection(n).map(function(t){return{lang:t,fonts:r[t]}}).value()}function y(e){var n=S(e),r=t.reduce(P.getFontsMetaData(),function(e,r,o){var a=r.characterSets;return t.includes(n,r.permissions)&&(r.cssFontFamily=l(o),t.forEach(a,function(t){e[t]||(e[t]=[]),e[t].push(r)})),e},{});return t.forOwn(r,function(e,n){r[n]=t.sortBy(e,"displayName")}),r}function h(e,n,r){var o=U(t.isArray(e)?e:t.keys(e),n,r);return o?W+o:""}function S(t){var e=["all","legacy"];return"WixSite"===t&&e.push("studio"),e}function U(e,n,r){var o="",a=S(n);return t.forEach(e,function(e){var n=P.getFontsMetaData()[e];n&&n.cdnName&&t.includes(a,n.permissions)&&(o+=n.cdnName,o+=":n,b,i,bi|")}),""===o?null:(r&&(o+="&subset="+r.join(",")),o)}function C(t){M.lastIndex=0;var e=M.exec(t);return e?e[1]:void 0}function b(t){return t.publicStaticsUrl+"/css/Helvetica/fontFace.css"}function T(t,n){var r={langauges:e.media.getMediaUrl(t,"user-site-fonts/v3/languages.css")};return"WixSite"===n&&(r.helveticas=e.media.getMediaUrl(t,"user-site-fonts/v3/helvetica.css")),r}function x(e,n){var r={};return r.googleFonts=h(P.getFontsMetaData(),e,D),t.merge(r,T(n,e)),r}var P=n.fonts,W="//fonts.googleapis.com/css?family=",D=["latin-ext","cyrillic","japanese","korean","arabic","hebrew","latin"],M=/<[^>]+class="[^"]*(font_[0-9]+)[^"]*"/g,k={StyledText:function(t,e){return[e.text]},RichText:function(t,e){return[e.text]}},_={};return e.sessionFreezer.freeze(_),{parseFontStr:P.parseFontStr,parseStyleFont:P.parseStyleFont,getMetadata:s,getGoogleFontsUrl:u,getFontFamily:P.getFontFamily,getFontFallback:P.getFontFallback,getPageFontsMetaData:f,getFontFamilyWithFallbacks:P.getFontFamilyWithFallbacks,getWixStoredFontsCssUrls:p,getWixStoredFontsCssUrlsWithParams:P.getWixStoredFontsCssUrlsWithParams,getCurrentSelectablefontsWithParams:v,collectFontsFromTextDataArray:e.fonts.fontsParser.collectFontsFromTextDataArray,getFontsUrlWithParams:P.getFontsUrlWithParams,getFontFamilyByStyleId:m,getFontClassName:C,registerCustomTextDataGetter:r,registerCustomFontFamiliesGetter:o,getPageUsedFontsList:c,getWixHelveticaUrl:b,getCssUrls:x,fontToCSSWithColor:P.fontToCSSWithColor,getFontFamilyPermissions:P.getFontFamilyPermissions,POSSIBLE_CHARACTERS_SETS:D}}),define("fonts/utils/fontCss",["lodash","fonts/utils/fontUtils"],function(t,e){function n(t){var n=t,r=e.getFontFallback(t);return r&&(n=n+","+r),n=n.replace(/[^,]*[^\w,\d\-][^,]*/g,function(t){return"'"+t.replace(/\+/g," ")+"'"})}function r(r){var o=r;t.includes(o,"#")&&(o=o.slice(0,o.indexOf("#"))),o=o.replace(/\{color_\d+\}/,"");var a=e.getFontFamily(o),s=n(a);return o.replace(a,s)+";"}function o(e,n){if(t.startsWith(e,"font_")){var r=e.split("font_");if(2===r.length)return n.font[r[1]]}return e}function a(t,e){return r(o(t,e))}function s(n,r){var o="";return t.forEach(n,function(t,n){o+=".font_"+n+" {font: "+e.fontToCSSWithColor(t,r)+"} \n"}),o}return{fontToCSSWithoutColor:a,getThemeFontsCss:s,getFullFontFamily:n}}),define("fonts/utils/fontsTracker",["lodash","fonts/utils/fontUtils"],function(t,e){function n(n,s){if(!t.isObject(n))return!1;a.masterPage=a.masterPage||r(n,"masterPage"),a[s]=a[s]||r(n,s);var i=t.union(a.masterPage,a[s]),l=e.getMetadata(i);return t.some(l,{permissions:o.permissions,provider:o.provider})}function r(t,n){return e.getPageUsedFontsList(t,n)}var o={permissions:"all",provider:"monotype"},a=Object.create(null);return{shouldTrackFonts:n}}),define("fonts",["fonts/utils/fontUtils","fonts/utils/fontCss","fonts/utils/fontsTracker","coreUtilsLib"],function(t,e,n,r){return{fontUtils:t,fontCss:e,fontMetadata:r.fonts.getFontsMetaData(),uplodedFontsUtils:{isUploadedFontFamily:r.fonts.isUploadedFontFamily,getUploadedId:r.fonts.getUploadedId,getUploadedFontFaceStyles:r.fonts.getUploadedFontFaceStyles,getUploadedFontValue:r.fonts.getUploadedFontValue},fontsTracker:n}});
//# sourceMappingURL=fonts.min.js.map