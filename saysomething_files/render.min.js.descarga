"use strict";define("render/bi/events.json",[],function(){return{SERVER_SIDE_RENDERING_DEBUG:{eventId:4,reportType:"event",endpoint:"bt",src:29,sampleRatio:1,params:{phaseName:"phaseName",errorType:"errorType",error_message:"error_message",statusid:"statusid"}}}}),define("render/bi/events",["render/bi/events.json","loggingUtils"],function(e,r){return r.logger.register("render","event",e),e}),define("render",["lodash","reactDOM","utils","core","render/bi/events","loggingUtils","experiment","animations","tweenEngine","TweenMax","TimelineMax"],function(e,r,n,t,i,s,o,a,d,w,c){function u(e,r){window.clientSideRender?r&&r():requirejs(["warmup"],function(r){e(r)})}function p(e){var r=d.create(w,c);return e.fullSiteData.animations=a.create(r),e}function l(e,r){return p(t.renderer.createSitePrivates(e,r))}function f(e){var r=window.document.getElementById("SITE_CONTAINER");r&&(r.dataset?r.dataset.santaRenderStatus=e:r.setAttribute("data-santa-render-status",e))}function g(e,r){var n=r.query,t=(e[n.configName||"fullFunctionality"]||e.fullFunctionality).getConfig();if(!n.dsOrigin)throw new Error("You must define dsOrigin parameter in order to use the documentServices - please speak to html-server team for a key");return t.origin=n.dsOrigin,t}function m(e,r,n,t){s.logger.reportBI(e,i.SERVER_SIDE_RENDERING_DEBUG,{phaseName:"diverge_reporting_failed",statusid:r||0,errorType:n||"noErrorType",error_message:t||"noErrorMessage"})}function S(r,t,i,s,o){n.ajaxLibrary.ajax({type:"POST",url:"https://jy75p2avi1.execute-api.us-west-2.amazonaws.com/prod/logDiffs",dataType:"json",headers:{"x-api-key":"NrelGcqXZH9pIBYc3zjA77SIpiBKUkp643H7P41F"},success:function(n,t,i){(n.errorType||n.errorMessage)&&m(r,e.get(i,"status",0),n.errorType,n.errorMessage)},data:{vsi:o,santaVersion:s,url:window.location.href,ssrDiverge:{clientMarkup:t,serverMarkup:i}},error:function(n,t,i){m(r,e.get(n,"status",0),t,i)}})}function v(e,r){u(function(r){r.willRender(e)}),window.clientSideRender&&window.santaRenderingError&&window.parent&&window.parent.postMessage({santaRenderingError:window.santaRenderingError.errorInfo},"*");var n=window.document.getElementById("SITE_CONTAINER").children[0];r.onBeforeLayout=function(){var r=window.document.getElementById("SITE_CONTAINER").children[0],t=r.innerHTML;window.sssr.clientSantaVersion=r.getAttribute("data-santa-version"),u(function(i){window.sssr.success=n===r,f(window.sssr.success?"SUCCESS":"DIVERGE"),window.sssr.clientSideRender={sinceInitialTimestamp:Date.now()-window.wixBiSession.initialTimestamp,performanceNow:D()},window.parent&&(window.sssr.success?window.parent.postMessage("sssrSuccess","*"):(window.sssr.clientSantaVersion!==window.sssr.serverSantaVersion&&(t=window.sssr.clientSantaVersion,window.sssr.serverMarkup=window.sssr.serverSantaVersion),window.sssr.clientMarkup=t,window.sssr.serverMarkup=window.sssr.serverMarkup||n.outerHTML,window.parent.postMessage({sssrFail:{clientMarkup:window.sssr.clientMarkup,serverMarkup:window.sssr.serverMarkup}},"*"),S(e,window.sssr.clientMarkup,window.sssr.serverMarkup,window.sssr.clientSantaVersion,e.wixBiSession.viewerSessionId))),i.didRender(e,window.sssr.success)},function(){f("CLIENT")})}}function E(n,t){return function(i){window.rendered?window.rendered.forceUpdate():(window.rendered=r.render(i,window.document.getElementById("SITE_CONTAINER")),window.onpopstate=window.rendered.onPopState,window.onhashchange=window.rendered.onHashChange,window.parent!==window&&requirejs(["santaPreview"],function(e){window.rendered.registerAspectToEvent("siteReady",function(){t&&t(window.rendered),window.documentServices&&(window.parent.postMessage("documentServicesLoaded","*"),window.createSantaPreview=e)})}),n.qaAutomation&&(e.set(window,"testApi.domSelectors",n.qaAutomation.getDomSelectors(n.react,n.reactDOM)),window.testApi.domSelectors.setSearchRoot(window.rendered),window.testApi.isReady=!0))}}function y(e,r,n,i,s){v(r,i),t.renderer.renderSite(r,n,i,E(e,s))}function I(r,n){e.forOwn(n,function(e){r.createDisplayedPage(e.structure.id)})}function R(r,i,s,a,d){r.componentsPreviewLayer&&r.componentsPreviewLayer.extendCompClasses();var w=l(i,s),c=r.documentServices;try{c&&e.isUndefined(window.karmaIntegration)&&o.isOpen("sv_fullstory",s)&&n.integrations.fullStory.start(s)}catch(e){}c?(w.siteDataWrapper.dataLoadedRegistrar=w.siteDataAPI.registerDataLoadedCallback.bind(w.siteDataAPI),window.documentServices=new c.Site(g(c.configs,w.siteModel.currentUrl),w.siteDataWrapper,e.partial(t.renderer.fixPages,w.siteModel,w.isServerSideRender),e.partial(y,r,w.displayedSiteData,w.viewerPrivateServices,a),e.partial(I,w.siteDataAPI)),e.set(window,"testApi.documentServices",window.documentServices)):(t.renderer.extendPrivates(w),y(r,w.displayedSiteData,w.viewerPrivateServices,a,d))}function M(e,r,n,i,s){p(r),v(r.displayedSiteData,i),t.renderer.doRenderSite(n,i,E(e,s))}var D=Object.freeze("undefined"!=typeof window&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date));return{renderClientSide:R,renderFromPrepared:M}});
//# sourceMappingURL=render.min.js.map