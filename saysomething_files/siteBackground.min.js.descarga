"use strict";define("siteBackground/skins/skins.json",[],function(){var e={};return e["wysiwyg.viewer.skins.siteBackgroundSkin"]={react:[["div","previous",[],{},["div","previousImage",[],{}],["div","previousVideo",[],{}],["div","previousOverlay",[],{}]],["div","current",[],{},["div","currentImage",[],{}],["div","currentVideo",[],{}],["div","currentOverlay",[],{}]]],css:{"%":"width:100%;position:absolute;","%bgBeforeTransition":"position:absolute;top:0;","%bgAfterTransition":"position:absolute;top:0;"}},e}),define("siteBackground",["lodash","santaProps","core","utils","mediaCommon","backgroundCommon","skins","siteBackground/skins/skins.json"],function(e,i,t,r,o,s,a,n){function d(e){return e.isExperimentOpen("sv_mobileBgFixed")?e.isMobileView?"viewport"!==e.compData.mediaSizing:!e.fixedSiteBackground:e.isMobileView||!e.fixedSiteBackground}function p(i,t){var r=e.get(i,"scrollType"),o=e.get(i,["mediaRef","type"]);return(!("Image"===o||"WixVideo"===o)||d(t)||t.isAndroidOldBrowser)&&(r="scroll"),r}function c(i,t){var r="absolute";return"WixVideo"!==e.get(i,["mediaRef","type"])&&"fixed"!==t&&"parallax"!==t||(r="fixed"),r}function u(e,i,t){var o=c(i,p(i,e)),s={top:0,height:b,width:f,backgroundColor:r.colorParser.getColor(e.colorsMap,i.color),display:t?"none":"",position:o};return e.isMobileView&&"fixed"===o&&(s.willChange="transform"),s}function l(e){var i=b;return"parallax"===e&&(i=P),i}function g(e){var i=B;return"parallax"===e&&(i=x),i}function h(e,i){var t=i.mediaRef,r=p(i,e),o={position:"absolute",top:g(r),height:l(r),width:f,opacity:t&&t.opacity};return e.isMobileView&&"fixed"===r&&(o.willChange="transform"),o}function v(i,t){var r=i.background,o=t.background,s=r.mediaRef||{},a=o.mediaRef||{},n=!r.mediaRef&&!o.mediaRef,d=n||s.type===a.type,p=i.mediaSizing===t.mediaSizing,c=["mediaRef","imageOverlay"],u=["type","alignType","fittingType","scrollType","colorOverlay","colorOverlayOpacity","color","videoId","uri","opacity"];return"WixVideo"===s.type&&d?u=e.without(u,"color"):n&&(u=["color"]),d&&p&&m(r,o,c,u)}function m(i,t,r,o){var s=e.every(o,function(e){return(i&&i[e])===(t&&t[e])});return s=s&&e.every(r,function(e){return!i||m(i[e],t[e],r,o)})}function y(e,i){var t=i.colorOverlay?r.colorParser.getColor(e.colorsMap,i.colorOverlay,i.colorOverlayOpacity):null,o=k(e,i.imageOverlay);return{position:"absolute",top:0,width:f,height:b,backgroundImage:o,backgroundColor:t}}function k(e,i){return i?"url("+r.urlUtils.joinURL(e.staticMediaUrl,i.uri)+")":null}var f="100%",b="100%",B=0,P="120%",x=0,V=r.mediaConsts,M=o.mediaLogicMixins.fill;return a.skinsMap.addBatch(n),{displayName:"SiteBackground",mixins:[M,t.compMixins.skinBasedComp,t.compMixins.animationsMixin,s.mixins.backgroundDetectionMixin],propTypes:e.defaults({id:i.Types.Component.id,compData:i.Types.Media.SiteBackground.data,actionsAspect:i.Types.SiteAspects.actionsAspect.isRequired,currentUrlPageId:i.Types.Component.currentUrlPageId,isMobileView:i.Types.isMobileView.isRequired,isTouchDevice:i.Types.Device.isTouchDevice,isAndroidOldBrowser:i.Types.Browser.isAndroidOldBrowser,colorsMap:i.Types.Theme.colorsMap,staticMediaUrl:i.Types.ServiceTopology.staticMediaUrl,componentViewMode:i.Types.RenderFlags.componentViewMode.isRequired,fixedSiteBackground:i.Types.BrowserFlags.fixedSiteBackground.isRequired,mediaQuality:i.Types.Media.SiteBackground.mediaQuality,isExperimentOpen:i.Types.isExperimentOpen},i.santaTypesUtils.getSantaTypesByDefinition(s.components.html5Video)),statics:{useSantaTypes:!0,behaviors:o.mediaBehaviors.fill},previousScroll:null,getInitialState:function(){return this.size={},{resetAttachment:!1,hidePrevious:!1}},callForBackgroundChange:function(i){var t={onComplete:function(){this.isPageChanged()&&(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,resetAttachment:!1,hidePrevious:!0}))}.bind(this)};this.props.actionsAspect.registerNextBGPageTransition(this,"previous","current",t),this.setState({previousPageBackground:i,resetAttachment:!0,hidePrevious:!1,currentVisiblePageId:null})},componentWillReceiveProps:function(i){if(this.props.currentUrlPageId!==i.currentUrlPageId){var t=this.props.compData;v(t,i.compData)?(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,currentVisiblePageId:this.state.currentVisiblePageId||this.props.compData.background.id})):this.callForBackgroundChange(t.background)}},handleParallaxBehavior:function(e){var i=p(e,this.props);("parallax"===this.previousScroll||"parallax"===i)&&(this.previousScroll=i,"parallax"===i?this.props.actionsAspect.registerBehaviors("currentImage","siteBackground",[{action:"bgScrub",name:"SiteBackgroundParallax",duration:1,delay:0}]):this.props.actionsAspect.unRegisterBehaviors("currentImage",[{action:"bgScrub",name:"SiteBackgroundParallax",duration:1,delay:0}]))},getClasses:function(){return""},isPageChanged:function(){return this.props.compData.background.id!==e.get(this.state,["previousPageBackground","id"])},createVideoComponent:function(i,t){var r={comp:"wysiwyg.viewer.components.background.html5Video",skin:"skins.viewer.bgVideo.html5VideoSkin",style:"bgVideo"},o=i.mediaRef,s="current"===t;return"WixVideo"!==e.get(o,"type")?(s&&this.setMediaAPI(null),null):this.createChildComponent(o,r.comp,{skin:r.skin,styleId:r.style},{id:this.props.id+t+"Video",key:"vid_"+o.videoId,notifyMediaState:this.onMediaChange,setMediaAPI:s?this.setMediaAPI:e.noop,mediaQuality:this.props.mediaQuality,className:"siteBackground"+t+"Video",compProp:e.pick(o,V.playback.SUPPORTED_MEDIA_ATTRIBUTES)})},getSkinProperties:function(){var i=this.state.currentVisiblePageId||this.props.compData.background.id,t=e.get(this.state.previousPageBackground,"id","noPrev");t=t===i?"noPrev":t;var r,o,s,a,n=null,d=!this.props.isTouchDevice,c=this.props.id,l=this.props.compData.background,g=h(this.props,l);a={id:c+"_currentImage_"+i,style:g,"data-type":V.balataConsts.BG_IMAGE,"data-height":g.height},d&&((o=this.createVideoComponent(l,"current"))||this.setMediaAPI(null)),this.state.previousPageBackground&&(s={id:c+"_previousImage_"+t,style:(n=this.state.previousPageBackground)?h(this.props,n):{}},d&&(r=this.createVideoComponent(n,"previous"))),this.handleParallaxBehavior(l);var v=u(this.props,l,!1);return{"":{id:c,className:this.getClasses()},current:{key:i+p(l,this.props)+this.props.componentViewMode,id:c+"_current_"+i,style:v,"data-position":v.position},currentImage:a,currentVideo:o,currentOverlay:{id:c+"_currentOverlay_"+i,style:y(this.props,l)},previous:{key:t+p(n,this.props)+this.props.componentViewMode,id:c+"_previous_"+t,style:n?u(this.props,n,this.state.hidePrevious):{}},previousImage:s,previousVideo:r,previousOverlay:{id:c+"_previousOverlay_"+t,style:n?y(this.props,n):{}}}}}});
//# sourceMappingURL=siteBackground.min.js.map